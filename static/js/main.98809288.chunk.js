(this["webpackJsonpreact-conway"]=this["webpackJsonpreact-conway"]||[]).push([[0],{13:function(e,t,n){},14:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(6),o=n.n(c),s=(n(13),n(1));var i=function(e,t){var n=Object(r.useRef)();Object(r.useEffect)((function(){n.current=e}),[e]),Object(r.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])};n(14);var u=function(){var e="object"===typeof window,t=Object(r.useCallback)((function(){return{width:e?window.innerWidth:void 0,height:e?window.innerHeight:void 0}}),[e]),n=Object(r.useState)(t),a=Object(s.a)(n,2),c=a[0],o=a[1];return Object(r.useEffect)((function(){if(!e)return!1;function n(){o(t())}return window.addEventListener("resize",n),function(){return window.removeEventListener("resize",n)}}),[t,e]),c},l=n(2),d=function(e,t){return{x:e%t,y:Math.floor(e/t)}},f=function(e,t){var n=e.x;return e.y*t+n},b=function(e,t,n){return((e+t)%(r=n)+r)%r;var r},v=function(e,t,n,r,a){var c=r-t,o=a-n,s=Object(l.a)(e);return c>0?s=function(e,t,n,r){for(var a=r-t,c=1;c<=n;c++){var o=(c-1)*a,s=c*t;e.splice.apply(e,[o+s,0].concat(Object(l.a)(Array(a).fill(0))))}return e}(e,t,n,r):c<0&&(s=function(e,t,n,r){for(var a=Math.abs(r-t),c=1;c<=n;c++){var o=c*r;e.splice(o,a)}return e}(e,t,n,r)),o>0?s=function(e,t,n,r){var a=r-n;return[].concat(Object(l.a)(e),Object(l.a)(Array(a*t).fill(0)))}(s,r,n,a):o<0&&(s=function(e,t,n,r){return e.slice(0,t*r)}(s,r,0,a)),s},h=function(e,t,n,r,a){for(var c=e.x,o=e.y,i=a.distanceVec,u=Object(l.a)(t),d=new Set,v=0,h=i.length;v<h;v++)if(1===a.template[v]){var m=Object(s.a)(i[v],2),p=m[0],w=m[1],O=f({x:b(c,p,n),y:b(o,w,r)},n);u[O]=a.template[v],d.add(O)}return{nBoard:u,paintedIndices:d}},m=function(e,t,n,r){for(var a=e.x,c=e.y,o=0,i=0,u=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];i<u.length;i++){var l=Object(s.a)(u[i],2),d=l[0],v=l[1],h=b(a,d,n),m=b(c,v,r);1===t[f({x:h,y:m},n)]&&(o+=1)}return o};function p(e,t,n){var a=Object(r.useState)(n),c=Object(s.a)(a,2),o=c[0],i=c[1],u=Object(r.useState)(!1),f=Object(s.a)(u,2),b=f[0],v=f[1];return[o,i,b,v,function(){for(var n=Object(l.a)(o),r=0,a=o.length;r<a;r++){var c=d(r,t),s=m(c,o,t,e);1===o[r]?(s<2||s>3)&&(n[r]=0):3===s&&(n[r]=1)}i(n),function(e){return e.every((function(e){return 0===e}))}(n)&&v(!1)}]}var w=n(3),O=function(e){var t=e.rows,n=e.cols;return{x:Math.floor((n-1)/2),y:Math.floor((t-1)/2)}},j=function(e){for(var t=e.rows,n=e.cols,r=O({rows:t,cols:n}),a=r.x,c=r.y,o=Array(t*n),s=0,i=t*n;s<i;s++){var u=d(s,n),l=u.x,f=u.y;o[s]=[l-a,f-c]}return o},g=function(e){var t=function(e){for(var t=e.template,n=e.rows,r=e.cols,a=Array(n*r),c=0,o=r-1;o>=0;o--)for(var s=0;s<n;s++){var i=f({x:o,y:s},r);a[c]=t[i],c++}return{template:a,rows:r,cols:n}}(e);return Object(w.a)({},e,{},t,{distanceVec:j(t)})},y={name:"Glider",displayName:"Glider",rows:3,cols:3,template:[0,1,0,0,0,1,1,1,1],distanceVec:j({cols:3,rows:3})};function E(e){var t=e.onChange,n=e.selectedBrush,r=e.brushesLoaded,c=e.brushes;return r?a.a.createElement("select",{className:"select",value:n.name,onChange:t},c.map((function(e){return a.a.createElement("option",{key:e.name,value:e.name},e.displayName)}))):a.a.createElement("div",null,"loading")}function S(e){var t=e.advanceBoard,n=e.toggleIsRunning,c=e.isRunning,o=e.setIsRunning,s=e.setBoard,i=e.board,u=e.setSelectedBrushWrapper,d=e.selectedBrush,f=e.touchHoverClear,b=e.setLastPaintedIndices,v=e.brushes,h=e.brushesLoaded,m=Object(r.useCallback)((function(e){"KeyE"!==e.code&&"click"!==e.type||(o(!1),s(Object(l.a)(i).fill(0)),b(new Set))}),[o,s,i,b]);Object(r.useEffect)((function(){return document.addEventListener("keydown",m,!1),function(){document.removeEventListener("keydown",m,!1)}}),[m]);var p=Object(r.useCallback)((function(e){"KeyW"!==e.code&&"click"!==e.type||(b(new Set),o(!1),t())}),[o,t,b]);return Object(r.useEffect)((function(){return document.addEventListener("keydown",p,!1),function(){document.removeEventListener("keydown",p,!1)}}),[p]),a.a.createElement("div",{className:"controls"},a.a.createElement("button",{className:"button",onTouchStart:f,onClick:function(){o(!1),t()}},"Next ",a.a.createElement("span",{className:"button__shortcut"},"[w]")),a.a.createElement("button",{className:"button",onTouchStart:f,onClick:n},c?"Stop ":"Start ",a.a.createElement("span",{className:"button__shortcut"},"[space]")),a.a.createElement("button",{className:"button",onTouchStart:f,onClick:m},"Empty",a.a.createElement("span",{className:"button__shortcut"}," [e]")),a.a.createElement("button",{className:"button button--mobile",onClick:function(){u(g(d))}},"Rotate 90deg"),a.a.createElement(E,{onChange:function(e){u(function(e,t){var n=t.filter((function(t){return t.name===e}))[0];return n.distanceVec=j(n),n}(e.target.value,v)),e.target.blur()},selectedBrush:d,brushesLoaded:h,brushes:v}),a.a.createElement("button",{className:"button button--desktop",onClick:function(){u(g(d))}},"Rotate 90deg",a.a.createElement("span",{className:"button__shortcut"}," [r]")))}function x(e){var t=e.contextMenuRef,n=e.children,r=e.isOpen,c=e.clickPosition,o=e.onBodyClick,s=e.openUp?"-100%":"0",i=e.openRight?"-100%":"0";return a.a.createElement("div",{className:"context-menu-wrapper ".concat(r),onClick:o},a.a.createElement("div",{ref:t,style:{left:c.x,top:c.y,transform:"translate(".concat(i,", ").concat(s,")")},className:"context-menu "},n))}var k=a.a.memo((function(e){var t=e.brush,n=e.onBrushSelect,c=e.isSelected,o=Object(r.useRef)(null),i=function(e){var t=e.cols,n=e.rows;return n>=t||2*n>t?{rows:n,cols:2*n}:t%2===0?{cols:t,rows:t/2}:{cols:t+1,rows:(t+1)/2}}(t),u=i.cols,v=i.rows,h=301/u-1,m=Object(w.a)({},t,{distanceVec:j(t)}),p=Array(v*u).fill(0);p=function(e,t,n,r,a){for(var c=e.x,o=e.y,i=a.distanceVec,u=Object(l.a)(t),d=0,v=i.length;d<v;d++)if(1===a.template[d]){var h=Object(s.a)(i[d],2),m=h[0],p=h[1];u[f({x:b(c,m,n),y:b(o,p,r)},n)]=a.template[d]}return u}(O({cols:u,rows:v}),p,u,v,m);var g=function(e,t,n,r){var a=d(n,r),c=a.x,o=a.y;e.fillStyle=1===t?"#00adb5":"#393e46",e.fillRect(c*h+c,o*h+o,h,h)};return Object(r.useEffect)((function(){for(var e=o.current.getContext("2d"),t=0,n=p.length;t<n;t++)g(e,p[t],t,u)})),a.a.createElement("div",{onClick:function(e){return n(m)},className:"brush-option ".concat(c?"brush-option--selected":"")},a.a.createElement("canvas",{className:"brush-option__canvas",style:{width:300,height:150},ref:o}),a.a.createElement("div",{className:"brush-option__title"},t.displayName))})),B=a.a.memo((function(e){var t=e.wrapperRef,n=e.brushes,c=e.brushesLoaded,o=e.onBrushSelect,i=e.selectedBrush,u=Object(r.useRef)(null),l=function(e,t){var n=Object(r.useState)(!1),a=Object(s.a)(n,2),c=a[0],o=a[1],i=Object(r.useState)({x:0,y:0}),u=Object(s.a)(i,2),l=u[0],d=u[1],f=Object(r.useState)(!1),b=Object(s.a)(f,2),v=b[0],h=b[1],m=Object(r.useState)(!1),p=Object(s.a)(m,2),w=p[0],O=p[1],j=Object(r.useState)(!1),g=Object(s.a)(j,2),y=g[0],E=g[1],S=Object(r.useCallback)((function(e){if(!y){e.preventDefault();var n=t.current.getBoundingClientRect(),r=e.clientX,a=e.clientY;r+n.width>window.innerWidth?O(!0):O(!1),a+n.height>window.innerHeight?h(!0):h(!1),d({x:r,y:a}),o(!0)}}),[o,d,h,O,t,y]),x=Object(r.useCallback)((function(e){E(!0)}),[E]);return Object(r.useEffect)((function(){var t=e.current;return t.addEventListener("contextmenu",S,!1),t.addEventListener("touchstart",x,!1),function(){t.removeEventListener("contextmenu",S,!1),t.removeEventListener("touchstart",x,!1)}}),[e,S,x]),[l,c,o,v,w]}(t,u),d=Object(s.a)(l,5),f=d[0],b=d[1],v=d[2],h=d[3],m=d[4],p=a.a.createElement("div",{className:"brush-hud__loading"},"Loading"),w=n.map((function(e){return a.a.createElement(k,{key:e.name,brush:e,isSelected:i.name===e.name,onBrushSelect:function(e){o(e),v(!1)}})}));return a.a.createElement(x,{contextMenuRef:u,onBodyClick:function(){v(!1)},isOpen:b,openUp:h,openRight:m,clickPosition:f},c?w:p)})),C=n(4),I=n.n(C),R=n(7),L=function(e,t){for(var n,r,a=0,c=/#([CcNOPrR]).*/gm,o=[];null!==(n=c.exec(t));)n.index===c.lastIndex&&c.lastIndex++,o.push(n[0]),a=c.lastIndex;try{return r=o[0].split("#N ")[1],e.name=r,e.displayName=r,++a}catch(s){console.log(s),console.log(t)}},N=function(e,t,n){var r,a=/^x.+/gm;a.lastIndex=n;for(var c=[];null!==(r=a.exec(t));)r.index===a.lastIndex&&a.lastIndex++,c.push(r[0]),n=a.lastIndex;var o=c[0].split(", "),i=Object(s.a)(o,2),u=i[0],l=i[1];return e.cols=parseInt(u.split(" = ")[1]),e.rows=parseInt(l.split(" = ")[1]),++n},M=function(e,t,n){for(var r,a=e.cols*e.rows,c=new Uint8Array(a),o=0,s=1,i=!1,u=0,l=t.length;n<l;n++)if((r=t.charCodeAt(n))>=48&&r<=57)i?(s*=10,s+=48^r):(s=48^r,i=!0);else{if(98===r)o+=s,u+=s;else if(r>=65&&r<=90||r>=97&&r<122)for(u+=s;s--;)c[o]=1,o++;else if(36===r)u<e.cols&&(o+=e.cols-u),s-1&&(o+=(s-1)*e.cols),u=0;else if(33===r)break;s=1,i=!1}e.template=c};function P(){return(P=Object(R.a)(I.a.mark((function e(t){var n,r,a,c,o,s,i,u,l;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:n=e.sent,r=new TextDecoder("utf-8"),a=n.body.getReader(),c="",o={};case 7:return e.next=10,a.read();case 10:if(s=e.sent,i=s.done,u=s.value,!i){e.next=15;break}return e.abrupt("break",18);case 15:c+=r.decode(u),e.next=7;break;case 18:return l=L(o,c),l=N(o,c,l),M(o,c,l),e.abrupt("return",o);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=["bigun.rle","crab.rle","glider.rle","glidertrain.rle","gosperglider.rle","hwss.rle","inlineinverter.rle","jaydot.rle","loafer.rle","lobster.rle","newgun2.rle","nms.rle","pixel.rle","rabbits.rle","simkinglider.rle","spacerake.rle","spider.rle","twogun.rle","wing.rle"];function z(e,t){var n=Object(r.useState)([]),a=Object(s.a)(n,2),c=a[0],o=a[1],i=Object(r.useState)(!1),u=Object(s.a)(i,2),l=u[0],d=u[1],f=Object(r.useState)([]),b=Object(s.a)(f,2),v=b[0],h=b[1];return Object(r.useEffect)((function(){Promise.all(_.map((function(e){return function(e){return P.apply(this,arguments)}("/react-conway/patterns/"+e)}))).then((function(e){d(!0),o(e)}))}),[]),Object(r.useEffect)((function(){var n=c.filter((function(n){return n.cols<=e&&n.rows<=t}));h(n)}),[e,t,c]),[v,l]}var H,A=function(e,t){return{x:Math.floor(e/16),y:Math.floor(t/16)}},T=function(e,t){var n=new Set,r=!0,a=!1,c=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var i=o.value;e.has(i)&&n.add(i)}}catch(u){a=!0,c=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw c}}return n},W=!1;function V(e){var t=e.board,n=e.windowSize,c=e.cols,o=e.rows,i=e.setBoard,u=e.setCols,l=e.setRows,b=e.brush,m=e.setHoverBoard,p=e.hoverBoard,w=e.seed,O=e.lastPaintedHoverIndices,j=e.lastPaintedIndices,g=e.setLastPaintedHoverIndices,y=e.setLastPaintedIndices,E=e.isRunning,S=Object(r.useRef)(null),x=Object(r.useState)(null),k=Object(s.a)(x,2),B=k[0],C=k[1],I=function(e,t,n,r){var a=d(n,r),c=a.x,o=a.y;e.fillStyle=1===t?"#00adb5":"#393e46",e.fillRect(15*c+c,15*o+o,15,15)},R=function(e,t,n,r){if(1===t&&(E||O.has(n))){var a=d(n,r),c=a.x,o=a.y;e.fillStyle=j.has(n)?"rgb(200,87,125)":"rgba(238, 238, 238, 0.3)",e.fillRect(15*c+c,15*o+o,15,15)}};return Object(r.useEffect)((function(){var e=Math.floor((n.height+1)/16),r=Math.floor((n.width+1)/16);c===r&&o===e||(i(v(t,c,o,r,e)),l(e),u(r))})),Object(r.useEffect)((function(){var e=S.current.getContext("2d");!function(e){e.clearRect(0,0,n.width,n.height)}(e);for(var r=0,a=t.length;r<a;r++)I(e,t[r],r,c),R(e,p[r],r,c)})),a.a.createElement("canvas",{ref:S,width:n.width,height:n.height,onClick:function(e){if(E||0===T(O,j).size){var n=A(e.pageX,e.pageY),r=h(n,t,c,o,b),a=r.nBoard,s=r.paintedIndices;y(E?new Set:s),i(a)}},onMouseLeave:function(){return m(w)},onTouchEnd:function(e){if(H=A(e.changedTouches[0].clientX,e.changedTouches[0].clientY),E||0===T(O,j).size||!W){var n=h(H,t,c,o,b),r=n.nBoard,a=n.paintedIndices;y(E?new Set:a),i(r)}W=!1,m(w),e.preventDefault()},onTouchMove:function(e){W=!0,H=A(e.touches[0].clientX,e.touches[0].clientY);var n=h(H,w,c,o,b),r=n.nBoard,a=n.paintedIndices;if(g(a),g(E?new Set:a),m(r),b.template.length<17&&(E||0===T(O,j).size)){var s=h(H,t,c,o,b),u=s.nBoard,l=s.paintedIndices;y(E?new Set:l),i(u)}},onMouseMove:function(e){H=A(e.pageX,e.pageY);var n=h(H,w,c,o,b),r=n.nBoard,a=n.paintedIndices;if(g(E?new Set:a),m(r),1===e.buttons||3===e.buttons){var s=f(H,c);if(E&&s!==B||!E&&0===T(O,j).size){var u=h(H,t,c,o,b),l=u.nBoard,d=u.paintedIndices;y(E?new Set:d),C(s),i(l)}}}})}function X(e){var t=e.cols,n=e.rows,c=e.seed,o=e.windowSize,u=e.setRows,l=e.setCols,d=p(n,t,c),f=Object(s.a)(d,2),b=f[0],v=f[1],m=p(n,t,c),w=Object(s.a)(m,5),O=w[0],j=w[1],E=w[2],x=w[3],k=w[4],C=Object(r.useState)(y),I=Object(s.a)(C,2),R=I[0],L=I[1],N=Object(r.useState)(new Set),M=Object(s.a)(N,2),P=M[0],_=M[1],A=Object(r.useState)(new Set),T=Object(s.a)(A,2),W=T[0],X=T[1],Y=z(t,n),D=Object(s.a)(Y,2),K=D[0],U=D[1],G=Object(r.useRef)(null);i(k,E?50:null);var J=Object(r.useCallback)((function(e){L(e)}),[L]),$=Object(r.useCallback)((function(e){32!==e.keyCode&&"click"!==e.type||(_(new Set),x(!E))}),[E,x,_]),q=Object(r.useCallback)((function(){v(c)}),[v,c]);Object(r.useEffect)((function(){return document.addEventListener("keydown",$,!1),function(){document.removeEventListener("keydown",$,!1)}}),[$]);var F=Object(r.useCallback)((function(e){if("KeyR"===e.code){J(g(R));var r=h(H,c,t,n,g(R)),a=r.nBoard,o=r.paintedIndices;X(o),v(a)}}),[J,R,c,t,n,v]);return Object(r.useEffect)((function(){return document.addEventListener("keydown",F,!1),function(){document.removeEventListener("keydown",F,!1)}}),[F]),a.a.createElement("div",{className:"App",ref:G},a.a.createElement(B,{wrapperRef:G,brushes:K,selectedBrush:R,onBrushSelect:J,brushesLoaded:U}),a.a.createElement(V,{board:O,brush:R,setBoard:j,windowSize:o,cols:t,setCols:l,setRows:u,rows:n,seed:c,setHoverBoard:v,hoverBoard:b,lastPaintedIndices:P,setLastPaintedIndices:_,lastPaintedHoverIndices:W,isRunning:E,setLastPaintedHoverIndices:X}),a.a.createElement(S,{advanceBoard:k,toggleIsRunning:$,isRunning:E,setIsRunning:x,setBoard:j,board:O,touchHoverClear:q,setSelectedBrushWrapper:J,selectedBrush:R,setLastPaintedIndices:_,brushes:K,brushesLoaded:U}))}var Y=function(){var e=u(),t=Object(r.useState)(Math.floor((e.height+1)/16)),n=Object(s.a)(t,2),c=n[0],o=n[1],i=Object(r.useState)(Math.floor((e.width+1)/16)),l=Object(s.a)(i,2),d=l[0],f=l[1],b=Array(c*d).fill(0);return a.a.createElement(X,{rows:c,cols:d,seed:b,windowSize:e,setRows:o,setCols:f})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,t,n){e.exports=n(16)}},[[8,1,2]]]);
//# sourceMappingURL=main.98809288.chunk.js.map